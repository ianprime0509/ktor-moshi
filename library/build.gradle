apply plugin: 'kotlin'
apply plugin: 'kotlin-kapt'
apply plugin: 'jacoco'

dependencies {
  compile deps.kotlin.stdlib
  compile deps.ktor.server
  compile deps.moshi.kotlin
  compile deps.okio

  testCompile deps.junit
  testCompile deps.truth
  testCompile deps.kotlin.stdlib
  testCompile deps.ktor.test
  kaptTest deps.moshi.codegen
}

apply from: rootProject.file('gradle/gradle-mvn-push.gradle')

test {
    finalizedBy jacocoTestReport
}
jacocoTestReport {
    dependsOn test
    reports {
        xml.enabled true
        html.enabled true
    }
    finalizedBy jacocoTestCoverageVerification
}

jacocoTestCoverageVerification {
    violationRules {
        rule {
            element = 'BUNDLE'
            excludes = ['"com.jacoco.dto.*"']

            limit {
                counter = 'INSTRUCTION'
                minimum = 0.7
            }

            limit {
                counter = 'BRANCH'
                minimum = 0.5
            }
        }
    }
}
